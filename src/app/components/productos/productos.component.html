<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="page-header">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <div class="d-flex align-items-center mb-2">
                            <div class="icon-badge bg-success">
                                <i class="bi bi-box-seam-fill"></i>
                            </div>
                            <h1 class="fw-bold mb-0 ms-3">Gestión de Productos</h1>
                        </div>
                        <p class="text-muted mb-0 ms-5 ps-2">
                            <i class="bi bi-info-circle me-2"></i>
                            Administra tu inventario de productos
                        </p>
                    </div>
                    <div>
                        <button (click)="abrirFormulario()" class="btn btn-primary btn-lg shadow-sm">
                            <i class="bi bi-plus-circle-fill me-2"></i>
                            Nuevo Producto
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert de error -->
    @if (error()) {
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                {{ error() }}
                <button type="button" class="btn-close" aria-label="Close"></button>
            </div>
        </div>
    </div>
    }

    <!-- Formulario -->
    @if (mostrarFormulario()) {
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-card">
                <div class="form-card-header">
                    <div class="d-flex align-items-center">
                        <div class="icon-badge-sm bg-success me-3">
                            <i class="bi bi-box-{{ productoEditandoId() ? 'arrow-in-down' : 'seam' }}-fill"></i>
                        </div>
                        <div>
                            <h4 class="mb-0 fw-bold">
                                {{ productoEditandoId() ? 'Actualizar' : 'Crear' }} Producto
                            </h4>
                            <small class="text-muted">
                                Completa la información del producto
                            </small>
                        </div>
                    </div>
                    <button type="button" (click)="cerrarFormulario()" class="btn-close-custom">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="form-card-body">
                    <form (ngSubmit)="guardarProducto()">
                        <div class="row g-3">
                            <div class="col-12">
                                <div class="form-floating">
                                    <input type="text" class="form-control form-control-lg" id="nombre"
                                        [(ngModel)]="formularioProducto().nombre" name="nombre"
                                        placeholder="Nombre del producto" />
                                    <label for="nombre">
                                        <i class="bi bi-tag me-2"></i>
                                        Nombre del Producto
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control form-control-lg" id="precio"
                                        [(ngModel)]="formularioProducto().precio" name="precio" placeholder="0.00"
                                        step="0.01" />
                                    <label for="precio">
                                        <i class="bi bi-currency-dollar me-2"></i>
                                        Precio
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control form-control-lg" id="exitencia"
                                        [(ngModel)]="formularioProducto().exitencia" name="exitencia" placeholder="0" />
                                    <label for="exitencia">
                                        <i class="bi bi-boxes me-2"></i>
                                        Existencia (Stock)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" (click)="cerrarFormulario()" class="btn btn-lg btn-light">
                                <i class="bi bi-x-circle me-2"></i>
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-lg btn-success">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Loading -->
    @if (cargando()) {
    <div class="row">
        <div class="col-12">
            <div class="loading-container">
                <div class="text-center">
                    <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-3 text-muted">Cargando productos...</p>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Empty state -->
    @else if (productos().length === 0) {
    <div class="row">
        <div class="col-12">
            <div class="empty-state-card">
                <div class="empty-state-icon bg-success-subtle">
                    <i class="bi bi-box-seam text-success"></i>
                </div>
                <h3 class="fw-bold mb-3">No hay productos registrados</h3>
                <p class="text-muted mb-4">
                    Comienza agregando tu primer producto al inventario
                </p>
                <button (click)="abrirFormulario()" class="btn btn-primary btn-lg">
                    <i class="bi bi-plus-circle-fill me-2"></i>
                    Crear primer producto
                </button>
            </div>
        </div>
    </div>
    }

    <!-- Tabla de productos -->
    @else {
    <div class="row">
        <div class="col-12">
            <div class="table-card">
                <div class="table-card-header">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div>
                            <h5 class="mb-0 fw-bold">
                                <i class="bi bi-grid-3x3-gap me-2"></i>
                                Lista de Productos
                            </h5>
                            <small class="text-muted mt-1 d-block">
                                Total: {{ productos().length }} productos
                            </small>
                        </div>
                      
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-box me-2 text-muted"></i>
                                        Producto
                                    </div>
                                </th>
                                <th>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-currency-dollar me-2 text-muted"></i>
                                        Precio
                                    </div>
                                </th>
                                <th>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-boxes me-2 text-muted"></i>
                                        Stock
                                    </div>
                                </th>
                                <th class="text-center">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <i class="bi bi-gear me-2 text-muted"></i>
                                        Acciones
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (producto of productos(); track producto.productoId) {
                            <tr [class.table-warning-subtle]="producto.exitencia < 5">
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="product-icon me-3">
                                            <i class="bi bi-box-seam-fill"></i>
                                        </div>
                                        <div>
                                            <div class="fw-semibold text-dark">{{ producto.nombre }}</div>
                                            <small class="text-muted">ID: #{{ producto.productoId }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-success-subtle text-success fw-semibold fs-6">
                                        L {{ producto.precio.toFixed(2) }}
                                    </span>
                                </td>
                                <td>
                                    <div class="stock-badge-container">
                                        @if (producto.exitencia < 5) { <span class="badge bg-danger text-white">
                                            <i class="bi bi-exclamation-triangle-fill me-1"></i>
                                            {{ producto.exitencia }} unidades
                                            </span>
                                            } @else if (producto.exitencia < 10) { <span
                                                class="badge bg-warning text-dark">
                                                <i class="bi bi-exclamation-circle me-1"></i>
                                                {{ producto.exitencia }} unidades
                                                </span>
                                                } @else {
                                                <span class="badge bg-success-subtle text-success">
                                                    <i class="bi bi-check-circle me-1"></i>
                                                    {{ producto.exitencia }} unidades
                                                </span>
                                                }
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex gap-2 justify-content-center">
                                        <button (click)="editarProducto(producto)" class="btn btn-sm btn-warning">
                                            <i class="bi bi-pencil-square me-1"></i>
                                            Editar
                                        </button>
                                        <button (click)="eliminarProducto(producto.productoId)"
                                            class="btn btn-sm btn-danger">
                                            <i class="bi bi-trash3 me-1"></i>
                                            Eliminar
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    }
</div>